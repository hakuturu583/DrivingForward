services:
  drivingforward:
    build:
      context: ..
      dockerfile: docker/Dockerfile
      args:
        UID: "${UID:-1000}"
        GID: "${GID:-1000}"
    image: drivingforward:latest
    container_name: drivingforward
    user: "${UID:-1000}:${GID:-1000}"
    volumes:
      - ..:/workspace/DrivingForward
      - /mnt/sata_ssd/nuscenes_full/v1.0:/workspace/DrivingForward/input_data/nuscenes
      - ../output:/workspace/DrivingForward/output
    working_dir: /workspace/DrivingForward
    environment:
      - DGP_PATH=/workspace/DrivingForward
      - XDG_CACHE_HOME=/workspace/DrivingForward/.cache
      - XDG_CONFIG_HOME=/workspace/DrivingForward/.config
      - MPLCONFIGDIR=/workspace/DrivingForward/.config/matplotlib
      - TORCH_CUDA_ARCH_LIST=7.5;8.0;8.6
    deploy:
      resources:
        reservations:
          devices:
            - driver: nvidia
              count: all
              capabilities: ["gpu"]
    tty: true
    stdin_open: true
    shm_size: "24gb"
